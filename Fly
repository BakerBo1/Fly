-- Fly Script
local player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local FlySpeed = 50 -- Adjust the speed as needed

local function startFlying()
    FlyLoop = RunService.Stepped:Connect(function()
        spawn(function()
            pcall(function()
                local speed = FlySpeed
                local velocity = Vector3.new(0, 1, 0)

                if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.LookVector * speed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.RightVector * -speed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.LookVector * -speed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.RightVector * speed)
                end

                player.Character.HumanoidRootPart.Velocity = velocity
                player.Character.Humanoid:ChangeState("Freefall")
            end)
        end)
    end)
end

local function stopFlying()
    if FlyLoop then
        FlyLoop:Disconnect()
        FlyLoop = nil
        player.Character.Humanoid:ChangeState("Landing")
    end
end

-- Ensure fly starts immediately upon script injection
startFlying()

-- Ensure fly reinitializes on respawn
player.CharacterAdded:Connect(function(character)
    startFlying()
end)
